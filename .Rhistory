)),
INCOME2 = factor(INCOME2, levels = 1:8, labels = c(
"<$10k", "$10–15k", "$15–20k", "$20–25k", "$25–35k", "$35–50k", "$50–75k", ">$75k"
))
)
# Create Table 1
table1 <- brfss_2017 %>%
select(VapeStatus, ASTHMA3, SEX, EDUCA, INCOME2) %>%
tbl_summary(by = VapeStatus, missing = "ifany") %>%
add_overall() %>%
bold_labels()
table1
library(gtsummary)
library(dplyr)
# Clean up data for continuous variables
brfss_2017_cont <- brfss_2017 %>%
filter(!is.na(`_ECIGSTS`), !is.na(`_AGE80`), !is.na(ALCDAY5)) %>%
filter(ALCDAY5 < 777) %>%  # remove special codes (777 = Don't know, 999 = Refused)
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used"))
)
table2 <- brfss_2017_cont %>%
select(VapeStatus, `_AGE80`, ALCDAY5) %>%
tbl_summary(
by = VapeStatus,
statistic = all_continuous() ~ "{mean} (± {sd})",
digits = all_continuous() ~ 1
) %>%
add_overall() %>%
bold_labels()
table2
library(gtsummary)
library(dplyr)
brfss_2017_cont <- brfss_2017 %>%
filter(!is.na(`_ECIGSTS`), !is.na(`_AGE80`), ALCDAY5 < 777) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used")),
DRINK_DAYS = ifelse(ALCDAY5 >= 101 & ALCDAY5 <= 130, ALCDAY5 - 100,
ifelse(ALCDAY5 == 888, 0, NA))
)
table2 <- brfss_2017_cont %>%
select(VapeStatus, `_AGE80`, DRINK_DAYS) %>%
tbl_summary(
by = VapeStatus,
statistic = all_continuous() ~ "{mean} (± {sd})",
digits = all_continuous() ~ 1
) %>%
add_overall() %>%
bold_labels()
table2
library(ggplot2)
library(dplyr)
# Re-filter & label relevant data
graph1_data <- brfss_2017 %>%
filter(!is.na(`_ECIGSTS`), ASTHMA3 %in% c(1, 2)) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used")),
Asthma = factor(ASTHMA3, levels = c(1, 2), labels = c("Yes", "No"))
)
# Create the bar plot
ggplot(graph1_data, aes(x = VapeStatus, fill = Asthma)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
title = "Asthma Status by Vaping Status",
x = "Vaping Status",
y = "Proportion",
fill = "Asthma"
) +
theme_minimal()
library(ggplot2)
library(dplyr)
# Re-filter & label relevant data
graph1_data <- brfss_2017 %>%
filter(!is.na(`_ECIGSTS`), ASTHMA3 %in% c(1, 2)) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used")),
Asthma = factor(ASTHMA3, levels = c(1, 2), labels = c("Yes", "No"))
)
# Create the bar plot
ggplot(graph1_data, aes(x = VapeStatus, fill = Asthma)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
title = "Asthma Status by Vaping Status",
x = "Vaping Status",
y = "Proportion",
fill = "Asthma"
) +
theme_minimal()
table(graph1_data$VapeStatus, graph1_data$Asthma)
library(ggplot2)
library(dplyr)
# Re-filter & label relevant data
graph1_data <- brfss_2017 %>%
filter(!is.na(`_ECIGSTS`), ASTHMA3 %in% c(1, 2)) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used")),
Asthma = factor(ASTHMA3, levels = c(1, 2), labels = c("Yes", "No"))
)
# Create the bar plot
ggplot(graph1_data, aes(x = VapeStatus, fill = Asthma)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
title = "Asthma Status by Vaping Status",
x = "Vaping Status",
y = "Proportion",
fill = "Asthma"
) +
theme_minimal()
table(graph1_data$VapeStatus, graph1_data$Asthma)
unique(brfss_2017$ASTHMA3)
unique(brfss_2017$`_ECIGSTS`)
library(dplyr)
library(ggplot2)
graph1_data <- brfss_2017 %>%
filter(`_ECIGSTS` %in% c(1, 2, 3), ASTHMA3 %in% c("Yes", "No")) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used"))
)
ggplot(graph1_data, aes(x = VapeStatus, fill = ASTHMA3)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
title = "Asthma Status by Vaping Status",
x = "Vaping Status",
y = "Proportion",
fill = "Asthma"
) +
theme_minimal()
library(dplyr)
library(ggplot2)
# Clean and prepare ALCDAY5
graph2_data <- brfss_2017 %>%
filter(`_ECIGSTS` %in% c(1, 2, 3), ALCDAY5 < 888) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used")),
DrinkDays = case_when(
ALCDAY5 >= 101 & ALCDAY5 <= 130 ~ ALCDAY5 - 100,
TRUE ~ NA_real_
)
) %>%
filter(!is.na(DrinkDays))
# Plot boxplot
ggplot(graph2_data, aes(x = VapeStatus, y = DrinkDays, fill = VapeStatus)) +
geom_boxplot() +
labs(
title = "Alcohol Use (Days Drank in Past 30) by Vaping Status",
x = "Vaping Status",
y = "Drinking Days (Past 30)"
) +
theme_minimal() +
theme(legend.position = "none")
library(dplyr)
library(ggplot2)
graph3_data <- brfss_2017 %>%
filter(`_ECIGSTS` %in% c(1, 2, 3), !is.na(`_AGE80`)) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used"))
)
ggplot(graph3_data, aes(x = VapeStatus, y = `_AGE80`, fill = VapeStatus)) +
geom_boxplot() +
labs(
title = "Age Distribution by Vaping Status",
x = "Vaping Status",
y = "Age (Capped at 80+)"
) +
theme_minimal() +
theme(legend.position = "none")
library(dplyr)
library(ggplot2)
# Prepare data
graph4_data <- brfss_2017 %>%
filter(`_ECIGSTS` %in% c(1, 2, 3), EDUCA %in% 1:6) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used")),
Education = factor(EDUCA,
levels = 1:6,
labels = c("No School", "Grades 1–8", "Grades 9–11",
"High School", "Some College", "College Grad"))
)
# Plot stacked bar chart
ggplot(graph4_data, aes(x = VapeStatus, fill = Education)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Education Level by Vaping Status",
x = "Vaping Status",
y = "Proportion",
fill = "Education Level"
) +
theme_minimal()
brfss_2017 %>%
count(EDUCA)
library(dplyr)
library(ggplot2)
# Filter and rename vape status only
graph4_data <- brfss_2017 %>%
filter(`_ECIGSTS` %in% c(1, 2, 3)) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used"))
)
# Plot using existing EDUCA labels
ggplot(graph4_data, aes(x = VapeStatus, fill = EDUCA)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Education Level by Vaping Status",
x = "Vaping Status",
y = "Proportion",
fill = "Education Level"
) +
theme_minimal()
# Graph 5: Income Level by Vaping Status
library(ggplot2)
library(dplyr)
brfss_2017 %>%
filter(!is.na(_ECIGSTS), !is.na(INCOME2)) %>%
# Graph 5: Income Level by Vaping Status
library(ggplot2)
library(dplyr)
brfss_2017 %>%
filter(!is.na(`_ECIGSTS`), !is.na(INCOME2)) %>%
mutate(
VapeStatus = factor(_ECIGSTS,
# Graph 5: Income Level by Vaping Status
library(ggplot2)
library(dplyr)
brfss_2017 %>%
filter(!is.na(`_ECIGSTS`), !is.na(INCOME2)) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used")),
Income = factor(INCOME2,
levels = c(1:8),
labels = c("<$10k", "$10–15k", "$15–20k", "$20–25k", "$25–35k", "$35–50k", "$50–75k", ">$75k"))
) %>%
ggplot(aes(x = VapeStatus, fill = Income)) +
geom_bar(position = "fill") +
labs(title = "Income Level by Vaping Status",
x = "Vaping Status", y = "Proportion", fill = "Income Level") +
theme_minimal()
# Recode income levels and drop 77/99
brfss_2017 <- brfss_2017 %>%
filter(`_ECIGSTS` %in% c(1, 2, 3)) %>%
mutate(
VapeStatus = case_when(
`_ECIGSTS` == 1 ~ "Current User",
`_ECIGSTS` == 2 ~ "Former User",
`_ECIGSTS` == 3 ~ "Never Used"
),
IncomeLevel = case_when(
INCOME2 == 1 ~ "<$10k",
INCOME2 == 2 ~ "$10–15k",
INCOME2 == 3 ~ "$15–20k",
INCOME2 == 4 ~ "$20–25k",
INCOME2 == 5 ~ "$25–35k",
INCOME2 == 6 ~ "$35–50k",
INCOME2 == 7 ~ "$50–75k",
INCOME2 == 8 ~ ">$75k"
)
) %>%
filter(!is.na(IncomeLevel))
# Plot
ggplot(brfss_2017, aes(x = VapeStatus, fill = IncomeLevel)) +
geom_bar(position = "fill") +
labs(
title = "Income Level by Vaping Status",
x = "Vaping Status",
y = "Proportion",
fill = "Income Level"
) +
scale_fill_brewer(palette = "Greens") +
theme_minimal()
table(brfss_2017$INCOME2, useNA = "always")
# Step 1: Convert to numeric (in case it's not already)
brfss_2017$INCOME2 <- as.numeric(brfss_2017$INCOME2)
# Step 2: Filter out invalid values (77, 99, NA) and recode the rest
brfss_2017 <- brfss_2017 %>%
filter(`_ECIGSTS` %in% c(1, 2, 3)) %>%
mutate(
VapeStatus = case_when(
`_ECIGSTS` == 1 ~ "Current User",
`_ECIGSTS` == 2 ~ "Former User",
`_ECIGSTS` == 3 ~ "Never Used"
),
IncomeLevel = case_when(
INCOME2 == 1 ~ "<$10k",
INCOME2 == 2 ~ "$10–15k",
INCOME2 == 3 ~ "$15–20k",
INCOME2 == 4 ~ "$20–25k",
INCOME2 == 5 ~ "$25–35k",
INCOME2 == 6 ~ "$35–50k",
INCOME2 == 7 ~ "$50–75k",
INCOME2 == 8 ~ ">$75k",
TRUE ~ NA_character_
)
) %>%
filter(!is.na(IncomeLevel))  # This ensures NA income levels are dropped
# Step 3: Check what you now have
table(brfss_2017$IncomeLevel, useNA = "always")
unique(brfss_2017$INCOME2)
colnames(brfss_2017)[grepl("INCOME", colnames(brfss_2017))]
table(brfss_2017$INCOME2, useNA = "always")
table(brfss_2017$`_INCOMG`, useNA = "always")
grep("income", names(brfss_2017), ignore.case = TRUE, value = TRUE)
table(brfss_2017$IncomeLevel, useNA = "always")
# Convert GENHLTH into readable labels
brfss_2017 <- brfss_2017 %>%
mutate(HealthStatus = factor(GENHLTH,
levels = c(1, 2, 3, 4, 5),
labels = c("Excellent", "Very Good", "Good", "Fair", "Poor")
))
# Plot
ggplot(brfss_2017, aes(x = HealthStatus, fill = VapeStatus)) +
geom_bar(position = "fill") +
labs(
title = "Proportion of Vaping Status by General Health",
x = "General Health Status",
y = "Proportion",
fill = "Vaping Status"
) +
theme_minimal()
table(brfss_2017$GENHLTH, useNA = "always")
table(brfss_2017$VapeStatus, useNA = "always")
colnames(brfss_2017)
table(brfss_2017$GENHLTH, useNA = "always")
colnames(brfss_2017)
library(ggplot2)
library(dplyr)
brfss_2017 %>%
filter(!is.na(HealthStatus), !is.na(VapeStatus)) %>%
ggplot(aes(x = HealthStatus, fill = VapeStatus)) +
geom_bar(position = "fill") +
labs(
title = "Proportion of Vaping Status by General Health",
x = "General Health Status",
y = "Proportion",
fill = "Vaping Status"
) +
theme_minimal()
library(ggplot2)
library(dplyr)
brfss_2017 %>%
filter(!is.na(HealthStatus), !is.na(VapeStatus)) %>%
ggplot(aes(x = HealthStatus, fill = VapeStatus)) +
geom_bar(position = "fill") +
labs(
title = "Proportion of Vaping Status by General Health",
x = "General Health Status",
y = "Proportion",
fill = "Vaping Status"
) +
theme_minimal()
mutate(
HealthStatus = case_when(
GENHLTH == 1 ~ "Excellent",
GENHLTH == 2 ~ "Very Good",
GENHLTH == 3 ~ "Good",
GENHLTH == 4 ~ "Fair",
GENHLTH == 5 ~ "Poor",
TRUE ~ NA_character_
)
)
library(ggplot2)
library(dplyr)
# Recreate the HealthStatus column from GENHLTH
brfss_2017 <- brfss_2017 %>%
mutate(
HealthStatus = case_when(
GENHLTH == 1 ~ "Excellent",
GENHLTH == 2 ~ "Very Good",
GENHLTH == 3 ~ "Good",
GENHLTH == 4 ~ "Fair",
GENHLTH == 5 ~ "Poor",
TRUE ~ NA_character_
)
) %>%
mutate(HealthStatus = factor(HealthStatus, levels = c("Excellent", "Very Good", "Good", "Fair", "Poor")))
library(ggplot2)
library(dplyr)
# Recreate the HealthStatus column from GENHLTH
brfss_2017 <- brfss_2017 %>%
mutate(
HealthStatus = case_when(
GENHLTH == 1 ~ "Excellent",
GENHLTH == 2 ~ "Very Good",
GENHLTH == 3 ~ "Good",
GENHLTH == 4 ~ "Fair",
GENHLTH == 5 ~ "Poor",
TRUE ~ NA_character_
)
) %>%
mutate(HealthStatus = factor(HealthStatus, levels = c("Excellent", "Very Good", "Good", "Fair", "Poor")))
brfss_2017 %>%
filter(!is.na(HealthStatus), !is.na(VapeStatus)) %>%
ggplot(aes(x = HealthStatus, fill = VapeStatus)) +
geom_bar(position = "fill") +
labs(
title = "Proportion of Vaping Status by General Health",
x = "General Health Status",
y = "Proportion",
fill = "Vaping Status"
) +
theme_minimal()
table(brfss_2017$GENHLTH, useNA = "always")
table(brfss_2017$HealthStatus, useNA = "always")
brfss_2017 %>%
filter(!is.na(VapeStatus), !is.na(HealthStatus)) %>%
summarise(count = n())
table(brfss_2017$GENHLTH, useNA = "always")
brfss_2017 %>%
filter(!is.na(VapeStatus), !is.na(HealthStatus)) %>%
summarise(count = n())
table(brfss_2017$GENHLTH, useNA = "always")
table(raw_brfss$GENHLTH, useNA = "always")
library(haven)
raw_brfss <- read_xpt("LLCP2017.XPT")
table(raw_brfss$GENHLTH, useNA = "always")
brfss_2017$GENHLTH <- raw_brfss$GENHLTH
brfss_2017 <- brfss_2017 %>%
left_join(raw_brfss %>% select(SEQNO, GENHLTH), by = "SEQNO")
brfss_2017 <- brfss_2017 %>%
mutate(
HealthStatus = factor(GENHLTH,
levels = c(1, 2, 3, 4, 5),
labels = c("Excellent", "Very Good", "Good", "Fair", "Poor")
)
)
nrow(raw_brfss)     # Should be ~450,000+
nrow(brfss_2017)     # If this is 0, that’s the issue
brfss_2017 <- raw_brfss %>%
filter(_ECIGSTS %in% c(1, 2, 3)) %>%
brfss_2017 <- raw_brfss %>%
filter(`_ECIGSTS` %in% c(1, 2, 3)) %>%
mutate(
VapeStatus = factor(`_ECIGSTS`,
levels = c(1, 2, 3),
labels = c("Current User", "Former User", "Never Used")
)
)
brfss_2017 <- brfss_2017 %>%
mutate(
HealthStatus = factor(GENHLTH,
levels = c(1, 2, 3, 4, 5),
labels = c("Excellent", "Very Good", "Good", "Fair", "Poor")
)
)
library(ggplot2)
library(dplyr)
# Make sure HealthStatus is properly labeled
brfss_2017 <- brfss_2017 %>%
mutate(
HealthStatus = factor(GENHLTH,
levels = c(1, 2, 3, 4, 5),
labels = c("Excellent", "Very Good", "Good", "Fair", "Poor")
)
)
# Create a plot
ggplot(brfss_2017, aes(x = HealthStatus, fill = VapeStatus)) +
geom_bar(position = "dodge") +
labs(
title = "General Health Status by Vaping Status",
x = "Self-Reported General Health",
y = "Count",
fill = "Vaping Status"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
library(ggplot2)
library(dplyr)
# Make sure HealthStatus is properly labeled
brfss_2017 <- brfss_2017 %>%
mutate(
HealthStatus = factor(GENHLTH,
levels = c(1, 2, 3, 4, 5),
labels = c("Excellent", "Very Good", "Good", "Fair", "Poor")
)
)
# Create a plot
ggplot(brfss_2017, aes(x = HealthStatus, fill = VapeStatus)) +
geom_bar(position = "dodge") +
labs(
title = "General Health Status by Vaping Status",
x = "Self-Reported General Health",
y = "Count",
fill = "Vaping Status"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
